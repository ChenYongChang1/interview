布隆过滤器
===

> 一个网站有 100 亿 url 存在一个黑名单中，每条 url 平均 64 字节。这个黑名单要怎么存？若此时随便输入一个 url，你如何快速判断该 url 是否在这个黑名单中？


参考
* [拜托，面试官别问我「布隆」了](https://juejin.im/post/5c959ff8e51d45509e2ccf84)

对于查找问题，使用散列表是一个常见的做法，但是由于散列表存储全部数据，需要占用比较多的空间。

可以通过位图的思想来处理，比如：有一千万个整数，其取值范围在1到1亿之间，判断某个数是否存在。可以通过建立一个长度为1亿的数组，然后将这一千万个整数作为数组的下标，然后判断对应下标是否存在，从而检测数据是否存在。

> 位图法：就是用每一位来存放某种状态，适用于大规模数据，但数据状态又不是很多的情况。

位图法的问题在于数组的长度由集合内的最大元素决定，如果数据的取值是1到十亿，则需要建立一个长度为10亿的数组，其消耗也是比较严重的。为了解决这个问题，提出了**布隆过滤器**的概念

> 布隆过滤器：可以用来判断一个元素是否在一个集合中。它的优势是只需要占用很小的内存空间以及有着高效的查询效率

布隆过滤器本身包含一个位数组和k个哈希函数
* 位数组就是数组的每个元素都只占用 1 bit，且每个元素只能为1或者0
* 当一个元素加入布隆过滤器时，使用这k个哈希函数计算k次，得到k个哈希值下标
* 将位数组中这k个下标的值置为1

然后检测一个元素是否存在时，只需要判断 位数组中，计算得到的k个哈希下标值是否都为1，如果不全为1，则表示元素不存在。

布隆过滤器的问题在于：不同的元素经过过滤器的哈希函数计算后，得到的k个哈希值可能会有重复的，因此当一个不在布隆过滤器中的元素，经过同样规则的哈希计算之后，得到的值在位数组中查询，有可能这些位置因为之前其它元素的操作先被置为 1 了。换句话说
* 布隆过滤器说某个元素在，可能会被误判
* 布隆过滤器说某个元素不在，那么一定不在

综上所述，布隆过滤器可以快速确定一个元素不在集合中，其使用场景有
* 网页爬虫对 URL 的去重，避免爬取相同的 URL 地址
* 进行垃圾邮件过滤：反垃圾邮件，从数十亿个垃圾邮件列表中判断某邮箱是否垃圾邮箱（同理，垃圾短信）
* 有的黑客为了让服务宕机，他们会构建大量不存在于缓存中的 key 向服务器发起请求，在数据量足够大的情况下，频繁的数据库查询可能导致 DB 挂掉。布隆过滤器很好的解决了缓存击穿的问题。
